@model IEnumerable<Pustok.Models.Slider>

@{
    ViewData["Title"] = "Sliders";
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Sliders List</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-success btn-sm" onclick="openCreateModal()">
                <i class="fas fa-plus"></i> Add New Slider
            </button>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-bordered table-hover" id="slidersTable">
            <thead>
                <tr>
                    <th>Order</th>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Subtitle</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr data-id="@item.Id">
                        <td>@item.Order</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.ImagePath))
                            {
                                <img src="~/@item.ImagePath" alt="@item.Title" style="width: 80px; height: 50px; object-fit: cover;" />
                            }
                        </td>
                        <td>@item.Title</td>
                        <td>@item.Subtitle</td>
                        <td>$@item.Price</td>
                        <td>
                            @if (item.IsActive)
                            {
                                <span class="badge badge-success">Active</span>
                            }
                            else
                            {
                                <span class="badge badge-danger">Inactive</span>
                            }
                        </td>
                        <td>
                            <button onclick="openEditModal(@item.Id)" class="btn btn-warning btn-sm">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteSlider(@item.Id)" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Create/Edit Modal -->
<div class="modal fade" id="sliderModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Create Slider</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form id="sliderForm">
                <div class="modal-body">
                    <input type="hidden" id="sliderId" />
                    <input type="hidden" id="createdDate" />

                    <div class="form-group">
                        <label for="title">Title *</label>
                        <input type="text" class="form-control" id="title" required />
                        <span class="text-danger" id="titleError"></span>
                    </div>

                    <div class="form-group">
                        <label for="subtitle">Subtitle *</label>
                        <input type="text" class="form-control" id="subtitle" required />
                        <span class="text-danger" id="subtitleError"></span>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" id="description" rows="3"></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="buttonText">Button Text *</label>
                                <input type="text" class="form-control" id="buttonText" required />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="buttonUrl">Button URL *</label>
                                <input type="text" class="form-control" id="buttonUrl" required />
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="price">Price</label>
                                <input type="number" class="form-control" id="price" step="0.01" value="0" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="order">Order</label>
                                <input type="number" class="form-control" id="order" value="0" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="imagePath">Image Path *</label>
                                <input type="text" class="form-control" id="imagePath" required />
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="backgroundColor">Background Color</label>
                                <select class="form-control" id="backgroundColor">
                                    <option value="bg-shade-whisper">Whisper</option>
                                    <option value="bg-shade-green">Green</option>
                                    <option value="bg-shade-pink">Pink</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="imagePosition">Image Position</label>
                                <select class="form-control" id="imagePosition">
                                    <option value="image-right">Right</option>
                                    <option value="image-left">Left</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="textAlignment">Text Alignment</label>
                                <select class="form-control" id="textAlignment">
                                    <option value="text-start">Left</option>
                                    <option value="text-center">Center</option>
                                    <option value="text-end">Right</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="isActive" checked />
                            <label class="form-check-label" for="isActive">Is Active</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
                let isEditMode = false;

         function openCreateModal() {
          isEditMode = false;
                    $('#modalTitle').text('Create Slider');
              $('#sliderForm')[0].reset();
             $('#sliderId').val('');
               $('#isActive').prop('checked', true);
                    $('.text-danger').text('');
              $('#sliderModal').modal('show');
          }

              function openEditModal(id) {
           isEditMode = true;
            $('#modalTitle').text('Edit Slider');
                    $('.text-danger').text('');

           $.get('@Url.Action("GetSlider", "Sliders")?id=' + id, function(data) {
            $('#sliderId').val(data.id);
            $('#title').val(data.title);
              $('#subtitle').val(data.subtitle);
              $('#description').val(data.description);
              $('#buttonText').val(data.buttonText);
               $('#buttonUrl').val(data.buttonUrl);
           $('#price').val(data.price);
               $('#order').val(data.order);
              $('#imagePath').val(data.imagePath);
               $('#backgroundColor').val(data.backgroundColor);
               $('#imagePosition').val(data.imagePosition);
              $('#textAlignment').val(data.textAlignment);
              $('#isActive').prop('checked', data.isActive);
              $('#createdDate').val(data.createdDate);
               $('#sliderModal').modal('show');
           });
          }

                $('#sliderForm').on('submit', function(e) {
           e.preventDefault();
        $('.text-danger').text('');

           var slider = {
                        Id: $('#sliderId').val() || 0,
            Title: $('#title').val(),
            Subtitle: $('#subtitle').val(),
            Description: $('#description').val(),
               ButtonText: $('#buttonText').val(),
               ButtonUrl: $('#buttonUrl').val(),
               Price: parseFloat($('#price').val()) || 0,
           Order: parseInt($('#order').val()) || 0,
            ImagePath: $('#imagePath').val(),
        BackgroundColor: $('#backgroundColor').val(),
               ImagePosition: $('#imagePosition').val(),
         TextAlignment: $('#textAlignment').val(),
               IsActive: $('#isActive').is(':checked'),
               CreatedDate: $('#createdDate').val() || new Date().toISOString()
                    };

                    var url = isEditMode ? '@Url.Action("Edit", "Sliders")' : '@Url.Action("Create", "Sliders")';

           $.ajax({
               url: url,
             type: 'POST',
          contentType: 'application/json',
            data: JSON.stringify(slider),
               headers: {
              'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
               },
               success: function(response) {
                if (response.success) {
               showNotification(response.message, 'success');
                $('#sliderModal').modal('hide');
               location.reload();
            } else {
         if (response.errors) {
              response.errors.forEach(function(error) {
           showNotification(error, 'error');
            });
               }
              }
            },
               error: function() {
            showNotification('An error occurred', 'error');
               }
           });
                });

                function deleteSlider(id) {
                    if (!confirm('Are you sure you want to delete this slider?')) {
              return;
                 }

           $.ajax({
        url: '@Url.Action("Delete", "Sliders")',
              type: 'POST',
               data: { id: id },
              headers: {
             'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
               },
         success: function(response) {
               if (response.success) {
               showNotification(response.message, 'success');
               $('tr[data-id="' + id + '"]').fadeOut(500, function() {
              $(this).remove();
               });
             } else {
               showNotification(response.message, 'error');
               }
            },
          error: function() {
               showNotification('An error occurred', 'error');
           }
           });
          }

                function showNotification(message, type) {
                var alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
                    var icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';

           var alert = $('<div class="alert ' + alertClass + ' alert-dismissible fade show" style="position:fixed;top:20px;right:20px;z-index:9999;">' +
                           '<i class="fas ' + icon + '"></i> ' + message +
                               '<button type="button" class="close" data-dismiss="alert">&times;</button>' +
                                    '</div>');

           $('body').append(alert);

           setTimeout(function() {
              alert.fadeOut(500, function() {
               $(this).remove();
              });
           }, 3000);
                }
    </script>

    @Html.AntiForgeryToken()
}
